<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>klusters: eventsprovider.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>eventsprovider.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">                          eventsprovider.h  -  description</span>
<a name="l00003"></a>00003 <span class="comment">                             -------------------</span>
<a name="l00004"></a>00004 <span class="comment">    begin                : Mon Jun 07 2004</span>
<a name="l00005"></a>00005 <span class="comment">    copyright            : (C) 2004 by Lynn Hazan</span>
<a name="l00006"></a>00006 <span class="comment">    email                : lynn.hazan.myrealbox.com</span>
<a name="l00007"></a>00007 <span class="comment"> ***************************************************************************/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/***************************************************************************</span>
<a name="l00010"></a>00010 <span class="comment"> *                                                                         *</span>
<a name="l00011"></a>00011 <span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span>
<a name="l00012"></a>00012 <span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span>
<a name="l00013"></a>00013 <span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<a name="l00014"></a>00014 <span class="comment"> *   (at your option) any later version.                                   *</span>
<a name="l00015"></a>00015 <span class="comment"> *                                                                         *</span>
<a name="l00016"></a>00016 <span class="comment"> ***************************************************************************/</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#ifndef EVENTSPROVIDER_H</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#define EVENTSPROVIDER_H</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a>00021 <span class="comment">//include files for the application</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;dataprovider.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;array.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;types.h&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">// include files for QT</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;qptrlist.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;qobject.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;qfile.h&gt;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">//include files for c/c++ libraries</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00040"></a><a class="code" href="classEventDescription.html">00040</a> <span class="keyword">class </span><a class="code" href="classEventDescription.html">EventDescription</a> : <span class="keyword">public</span> QString{
<a name="l00041"></a>00041  <span class="keyword">public</span>:
<a name="l00042"></a>00042   <span class="keyword">inline</span> <a class="code" href="classEventDescription.html">EventDescription</a>():QString(){};
<a name="l00043"></a>00043   <span class="keyword">inline</span> <a class="code" href="classEventDescription.html">EventDescription</a>(<span class="keyword">const</span> QString&amp; s):QString(s){};
<a name="l00044"></a>00044 };
<a name="l00045"></a>00045 
<a name="l00046"></a>00046  <span class="keywordtype">bool</span> operator&lt;(<span class="keyword">const</span> <a class="code" href="classEventDescription.html">EventDescription</a>&amp; s1,<span class="keyword">const</span> <a class="code" href="classEventDescription.html">EventDescription</a>&amp; s2);
<a name="l00047"></a>00047 
<a name="l00050"></a><a class="code" href="classEventsProvider.html">00050</a> <span class="keyword">class </span><a class="code" href="classEventsProvider.html">EventsProvider</a> : <span class="keyword">public</span> <a class="code" href="classDataProvider.html">DataProvider</a>  {
<a name="l00051"></a>00051    Q_OBJECT
<a name="l00052"></a>00052 <span class="keyword">public</span>:
<a name="l00053"></a>00053 
<a name="l00055"></a><a class="code" href="classEventsProvider.html#650a3830f7fd1b0393a6c21043b98a90">00055</a>   <span class="keyword">enum</span> <a class="code" href="classEventsProvider.html#650a3830f7fd1b0393a6c21043b98a90">loadReturnMessage</a> {OK=0,OPEN_ERROR=1,INCORRECT_CONTENT=2,COUNT_ERROR=3};
<a name="l00056"></a>00056 
<a name="l00062"></a>00062   <a class="code" href="classEventsProvider.html#f5a5408a39df110a761c0a05010c138f">EventsProvider</a>(KURL fileUrl,<span class="keywordtype">int</span> currentSamplingRate,<span class="keywordtype">int</span> position = 25);
<a name="l00063"></a>00063      ~<a class="code" href="classEventsProvider.html">EventsProvider</a>();
<a name="l00064"></a>00064 
<a name="l00071"></a>00071   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#d6dec09f16591b2f53cbddbdc96babb1">requestData</a>(<span class="keywordtype">long</span> startTime,<span class="keywordtype">long</span> endTime,QObject* initiator,<span class="keywordtype">long</span> startTimeInRecordingUnits = 0);
<a name="l00072"></a>00072 
<a name="l00081"></a>00081   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#3c5819196ba81514cdf34eec143ee34e">requestNextEventData</a>(<span class="keywordtype">long</span> startTime,<span class="keywordtype">long</span> timeFrame,QValueList&lt;int&gt; selectedIds,QObject* initiator);
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00092"></a>00092   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#e0c949e211c42562429ca95b9a260499">requestPreviousEventData</a>(<span class="keywordtype">long</span> endTime,<span class="keywordtype">long</span> timeFrame,QValueList&lt;int&gt; selectedIds,QObject* initiator);
<a name="l00093"></a>00093   
<a name="l00097"></a>00097   <span class="keywordtype">int</span> <a class="code" href="classEventsProvider.html#cceb976433725bd97a19f3c546fa7cfd">loadData</a>();
<a name="l00098"></a>00098 
<a name="l00102"></a><a class="code" href="classEventsProvider.html#9f02275111e4072e7cbd095a7d4191d1">00102</a>   <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classEventsProvider.html#9f02275111e4072e7cbd095a7d4191d1">getNbEvents</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> nbEvents;};
<a name="l00103"></a>00103 
<a name="l00106"></a><a class="code" href="classEventsProvider.html#9fcb77e64326554bc9adefdc7a6eb9d6">00106</a>   <span class="keyword">inline</span> QMap&lt;EventDescription,int&gt; <a class="code" href="classEventsProvider.html#9fcb77e64326554bc9adefdc7a6eb9d6">eventDescriptionIdMap</a>()<span class="keyword"> const</span>{<span class="keywordflow">return</span> eventIds;};
<a name="l00107"></a>00107   
<a name="l00110"></a><a class="code" href="classEventsProvider.html#0b33e8e7f42dbecd9e8c56fc4329531e">00110</a>   <span class="keyword">inline</span> QMap&lt;int,EventDescription&gt; <a class="code" href="classEventsProvider.html#0b33e8e7f42dbecd9e8c56fc4329531e">eventIdDescriptionMap</a>()<span class="keyword"> const</span>{<span class="keywordflow">return</span> idsDescriptions;};
<a name="l00111"></a>00111 
<a name="l00115"></a><a class="code" href="classEventsProvider.html#9dfb521f56c0d4627d01c40b50133c87">00115</a>   <span class="keyword">inline</span> QString <a class="code" href="classEventsProvider.html#9dfb521f56c0d4627d01c40b50133c87">getName</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> name;}
<a name="l00116"></a>00116 
<a name="l00120"></a><a class="code" href="classEventsProvider.html#55715274fc885148869b6bf4792cc4c8">00120</a>   <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classEventsProvider.html#55715274fc885148869b6bf4792cc4c8">getDescriptionLength</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> descriptionLength;};
<a name="l00121"></a>00121 
<a name="l00125"></a><a class="code" href="classEventsProvider.html#c67590bd2d844fa2f63c1db62b105900">00125</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#c67590bd2d844fa2f63c1db62b105900">setEventPosition</a>(<span class="keywordtype">int</span> position){eventPosition = static_cast&lt;float&gt;(position) / 100.0;};
<a name="l00126"></a>00126 
<a name="l00132"></a>00132   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#467a0837455cab20b9ffe80aefed2495">modifiedEvent</a>(<span class="keywordtype">int</span> selectedEventId,<span class="keywordtype">double</span> time,<span class="keywordtype">double</span> newTime);
<a name="l00133"></a>00133 
<a name="l00138"></a>00138   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#9653a7e52887010e832669bc532fd485">removeEvent</a>(<span class="keywordtype">int</span> selectedEventId,<span class="keywordtype">double</span> time);
<a name="l00139"></a>00139 
<a name="l00144"></a>00144   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#da7ddce431ab341fd442edd8a3656d49">addEvent</a>(QString eventDescriptionToAdd,<span class="keywordtype">double</span> time);
<a name="l00145"></a>00145 
<a name="l00147"></a>00147   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#33b3b25df10d7f1cd1056e4a5cd89606">undo</a>();
<a name="l00148"></a>00148 
<a name="l00150"></a>00150   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#699d0aa9a45ee2f51fb2d955fcfd52ce">redo</a>();
<a name="l00151"></a>00151 
<a name="l00153"></a>00153   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#3c2a61d9efc69320fc9aa7e5b42e6a72">clearUndoRedoData</a>();
<a name="l00154"></a>00154 
<a name="l00159"></a>00159   <span class="keywordtype">int</span> <a class="code" href="classEventsProvider.html#6f55d7200cc8ab7b038123309805fbb0">save</a>(QFile* eventFile);
<a name="l00160"></a>00160 
<a name="l00164"></a><a class="code" href="classEventsProvider.html#eff38c275b0ab413a0a54ecaa61e066d">00164</a>   <span class="keywordtype">bool</span> <a class="code" href="classEventsProvider.html#eff38c275b0ab413a0a54ecaa61e066d">isModified</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> modified;};
<a name="l00165"></a>00165 
<a name="l00167"></a>00167   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#c929d39f562537cd44d7413739673376">initializeEmptyProvider</a>();
<a name="l00168"></a>00168 
<a name="l00172"></a><a class="code" href="classEventsProvider.html#e3d90fb5b11664b6c5c3ae59cbe03700">00172</a>   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#e3d90fb5b11664b6c5c3ae59cbe03700">updateSamplingRate</a>(<span class="keywordtype">int</span> rate){
<a name="l00173"></a>00173    currentSamplingRate = static_cast&lt;float&gt;(static_cast&lt;float&gt;(rate) / 1000.0);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175    <span class="comment">//Initialize the variables</span>
<a name="l00176"></a>00176    previousStartTime = 0;
<a name="l00177"></a>00177    previousStartIndex = 1;
<a name="l00178"></a>00178    previousEndIndex = nbEvents;
<a name="l00179"></a>00179    previousEndTime = static_cast&lt;long&gt;(floor(0.5 + timeStamps(1,nbEvents)));
<a name="l00180"></a>00180    fileMaxTime = previousEndTime;
<a name="l00181"></a>00181   };
<a name="l00182"></a>00182 
<a name="l00188"></a>00188   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#db689c023b77cb984bbc2ac07ccae257">renameEvent</a>(<span class="keywordtype">int</span> selectedEventId,QString newEventDescription,<span class="keywordtype">double</span> time);
<a name="l00189"></a>00189   
<a name="l00190"></a>00190 signals:
<a name="l00197"></a>00197   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#e48e4f307cc9fbbb278b1c776f897a17">dataReady</a>(<a class="code" href="classArray.html">Array&lt;dataType&gt;</a>&amp; times,<a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; ids,QObject* initiator,QString providerName);
<a name="l00198"></a>00198 
<a name="l00206"></a>00206   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#543c534fb1baf205ef89cb37df7a212a">nextEventDataReady</a>(<a class="code" href="classArray.html">Array&lt;dataType&gt;</a>&amp; times,<a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; ids,QObject* initiator,QString providerName,<span class="keywordtype">long</span> startingTime);
<a name="l00207"></a>00207 
<a name="l00215"></a>00215   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#ce6a554d8f1d5c68dca9487d47f497a8">previousEventDataReady</a>(<a class="code" href="classArray.html">Array&lt;dataType&gt;</a>&amp; times,<a class="code" href="classArray.html">Array&lt;int&gt;</a>&amp; ids,QObject* initiator,QString providerName,<span class="keywordtype">long</span> startingTime);
<a name="l00216"></a>00216 
<a name="l00223"></a>00223   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#3780ad0f0a5cb7514a2903e2ef51d599">newEventDescriptionCreated</a>(QString providerName,QMap&lt;int,int&gt; oldNewEventIds,QMap&lt;int,int&gt; newOldEventIds,QString eventDescriptionAdded);
<a name="l00224"></a>00224 
<a name="l00232"></a>00232   <span class="keywordtype">void</span> <a class="code" href="classEventsProvider.html#e22f5448150f167a147c16a27ef61c95">eventDescriptionRemoved</a>(QString providerName,QMap&lt;int,int&gt; oldNewEventIds,QMap&lt;int,int&gt; newOldEventIds,<span class="keywordtype">int</span> eventIdToRemove,QString eventDescriptionToRemove);
<a name="l00233"></a>00233   
<a name="l00234"></a>00234 <span class="keyword">private</span>:
<a name="l00235"></a>00235 
<a name="l00237"></a>00237   QString name;
<a name="l00238"></a>00238   
<a name="l00240"></a>00240   <span class="keywordtype">float</span> currentSamplingRate;
<a name="l00241"></a>00241 
<a name="l00243"></a>00243   <a class="code" href="classArray.html">Array&lt;double&gt;</a> timeStamps;
<a name="l00244"></a>00244 
<a name="l00246"></a>00246   <a class="code" href="classpArray.html">pArray&lt;EventDescription&gt;</a> events;
<a name="l00247"></a>00247 
<a name="l00249"></a>00249   <a class="code" href="classArray.html">Array&lt;double&gt;</a> timeStampsUndo;
<a name="l00250"></a>00250 
<a name="l00252"></a>00252   <a class="code" href="classpArray.html">pArray&lt;EventDescription&gt;</a> eventsUndo;
<a name="l00253"></a>00253 
<a name="l00255"></a>00255   <a class="code" href="classArray.html">Array&lt;double&gt;</a> timeStampsRedo;
<a name="l00256"></a>00256 
<a name="l00258"></a>00258   <a class="code" href="classpArray.html">pArray&lt;EventDescription&gt;</a> eventsRedo;
<a name="l00259"></a>00259 
<a name="l00261"></a>00261   <span class="keywordtype">long</span> previousStartTime;
<a name="l00262"></a>00262 
<a name="l00264"></a>00264   <span class="keywordtype">long</span> previousEndTime;
<a name="l00265"></a>00265   
<a name="l00267"></a>00267   <span class="keywordtype">long</span> previousStartIndex;
<a name="l00268"></a>00268 
<a name="l00270"></a>00270   <span class="keywordtype">long</span> previousEndIndex;
<a name="l00271"></a>00271 
<a name="l00273"></a>00273   <span class="keywordtype">long</span> nbEvents;
<a name="l00274"></a>00274 
<a name="l00276"></a>00276   QMap&lt;EventDescription,int&gt; eventIds;
<a name="l00277"></a>00277 
<a name="l00279"></a>00279   QMap&lt;int,EventDescription&gt; idsDescriptions;
<a name="l00280"></a>00280 
<a name="l00282"></a>00282   <span class="keywordtype">int</span> descriptionLength;
<a name="l00283"></a>00283   
<a name="l00285"></a>00285   <span class="keywordtype">long</span> fileMaxTime;
<a name="l00286"></a>00286 
<a name="l00288"></a>00288   <span class="keywordtype">float</span> eventPosition;
<a name="l00289"></a>00289 
<a name="l00291"></a>00291   <span class="keywordtype">bool</span> modified;
<a name="l00292"></a>00292 
<a name="l00294"></a>00294   QMap&lt;EventDescription,int&gt; eventDescriptionCounter;
<a name="l00295"></a>00295 
<a name="l00297"></a>00297   QMap&lt;EventDescription,int&gt; eventDescriptionCounterUndo;
<a name="l00298"></a>00298 
<a name="l00300"></a>00300   QMap&lt;EventDescription,int&gt; eventDescriptionCounterRedo;
<a name="l00301"></a>00301   
<a name="l00302"></a>00302   <span class="comment">//Functions</span>
<a name="l00303"></a>00303 
<a name="l00309"></a>00309   <span class="keywordtype">void</span> retrieveData(<span class="keywordtype">long</span> startTime,<span class="keywordtype">long</span> endTime,QObject* initiator);
<a name="l00310"></a>00310 
<a name="l00315"></a>00315   <span class="keywordtype">long</span> findIndex(<span class="keywordtype">double</span> eventTime,<span class="keywordtype">int</span> eventId = -1);
<a name="l00316"></a>00316 
<a name="l00320"></a>00320   <span class="keywordtype">void</span> addEventDescription(QString eventDescriptionToAdd);
<a name="l00321"></a>00321 
<a name="l00325"></a>00325   <span class="keywordtype">void</span> removeEventDescription(QString eventDescriptionToRemove);
<a name="l00326"></a>00326 };
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Sep 13 21:12:47 2007 for klusters by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
